<?xml version="1.0" encoding="UTF-8" ?>

<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-2.1.xsd"
        require-authentication="false">
    <always-actions>
        <actions>
            <script>
                // TODO: Tighten up
                def response = ec.web.response
                response.addHeader('Access-Control-Allow-Origin', '*')
                response.addHeader('Access-Control-Allow-Methods', 'POST, GET, OPTIONS')
                response.addHeader('Access-Control-Allow-Headers', 'Content-Type')
            </script>
        </actions>
    </always-actions>
    <transition name="callback" method="get" read-only="true">
          	<service-call name="pac4j.AuthenticationServices.perform#Callback"/>
            <default-response type="none"/>
    </transition>
    <transition name="logout">
        <actions>
            <service-call name="pac4j.AuthenticationServices.perform#Logout" />
        </actions>
        <default-response type="none"/>
    </transition>

    <transition name="getApiKey" method="options">
        <default-response type="none" />
    </transition>
    <transition name="getApiKey" require-session-token="false">
        <service-call name="pac4j.AuthenticationServices.get#ApiKey" />
        <default-response type="none" />
    </transition>

    <subscreens default-item="Login">
        <subscreens-item name="Local" location="component://webroot/screen/webroot/Login.xml" />
    </subscreens>
    <widgets>
        <subscreens-active />
    </widgets>
</screen>
